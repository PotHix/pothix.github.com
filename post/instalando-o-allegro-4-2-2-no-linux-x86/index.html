<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <meta content="Willian Molinari a.k.a. PotHix" name="author">
        <meta property="og:title" content="Instalando o Allegro 4.2.2 no Linux x86 - PotHix">
        <meta property="og:url" content="http://pothix.com/post/instalando-o-allegro-4-2-2-no-linux-x86/">
        <meta property="og:description" content="The personal website for Willian Molinari, also known as PotHix">
        <meta property="og:type" content="website" />
        <meta name="generator" content="Hugo 0.40.2" />

        <title>Instalando o Allegro 4.2.2 no Linux x86 | PotHix</title>

        
        <link rel="dns-prefetch" href="//fonts.googleapis.com">

        

        <link rel="alternate" type="application/atom+xml" title="Atom Feed (all posts)" href="http://feeds.feedburner.com/PotHix" />
        <link rel="alternate" type="application/atom+xml" title="Atom Feed (all posts in English)" href="http://feeds.feedburner.com/EnglishPotHix" />
        <link rel="alternate" type="application/atom+xml" title="Atom Feed (all posts related to technology)" href="http://feeds.feedburner.com/PotHixTech" />

        <link rel="icon" type="image/png" href="/images/favico.png">
        <link rel="stylesheet" href="/stylesheets/style.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/stylesheets/stag-custom-styles.css" type="text/css" media="all" />

        <link rel="stylesheet" href="/stylesheets/font-awesome-4.3.0/css/font-awesome.min.css">
        <link rel="stylesheet" id="doctype-fonts-css"  href="http://fonts.googleapis.com/css?family=Rokkitt%3A700%7CLato%3A300%2C400%2C700%2C300italic&#038;subset=latin" type="text/css" media="all" />

        <body class="blog sticky-nav chrome stagtools">
            <div id="page" class="hfeed site">
                <header id="masthead" class="site-header site-header--fixed" role="banner">
                    <div class="inside">
                        <div id="navbar" class="navbar">
  <nav id="site-navigation" class="navigation main-navigation" role="navigation">
    <ul id="primary-menu" class="primary-menu">
      <li class="menu-item menu-item-type-post_type menu-item-object-page">
        <a href="/">Home</a>
      </li>
      <li class="menu-item menu-item-type-post_type menu-item-object-page">
        <a href="/coding">Coding</a>
      </li>
      <li class="menu-item menu-item-type-post_type menu-item-object-page">
        <a href="/speaking">Speaking</a>
      </li>
      <li class="menu-item menu-item-type-post_type menu-item-object-page">
        <a href="/writing">Writing</a>
      </li>
      <li class="menu-item menu-item-type-post_type menu-item-object-page">
        <a href="/now">Now</a>
      </li>
      <li class="menu-item menu-item-type-post_type menu-item-object-page">
        <a href="/about">About me</a>
      </li>
    </ul>
  </nav>
</div>

                        <a class="site-branding" href="/" title="Doctype" rel="home">
                            <span class="logo-container">
                                <img data-at2x src="/images/logo.png" alt="Website's logo">
                            </span>
                        </a>
                    </div>
                </header>


<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article class="post type-post status-publish format-standard has-post-thumbnail hentry category-wordpress tag-version tag-wordpress-2 mix">
         <header class="entry-header">
      	   <h2 class="entry-title">Instalando o Allegro 4.2.2 no Linux x86</h2>
         </header>

         <div class="entry-meta">
          <span class="posted-on">
            Published at August 12, 2009
          </span>
          <span class="tags-links">
            
            <a href="/tags/gamedev">gamedev</a>,
            
            <a href="/tags/tech">tech</a>,
            
            <a href="/tags/linux">linux</a>,
            
          </span>
        </div>

        <div class="entry-content">
          <p>Como mencionei no
<a href="http://pothix.com/blog/development/gamejam" title="Post sobre o GameJam">meu ultimo post</a>
eu parcicipei do GameJam do Itaú cultural e desenvolvi um jogo com
Allegro. Agora com o jogo pronto estou criando arquivos executáveis
para divulgar e tinha me esquecido da diferença de arquitetura no
Linux, assim compilei apenas para meu Linux x64.</p>

<p>Quando me dei conta que não funcionou no computador do trabalho por
que eu tinha um binário x64, eu tive que instalar o Allegro no
computador de lá para poder fazer funcionar também em Linux
x86. Pensei eu:</p>

<blockquote>
<p>&ldquo;Vai ser moleza, assim como foi instalar o <a href="http://sourceforge.net/projects/alleg/files/allegro/4.2.2/allegro-4.2.2.tar.gz/download" title="Allegro 4.2.2 download">Allegro
4.2.2</a> no notebook x64&rdquo;</p>
</blockquote>

<p>E lá fui eu:</p>

<pre><code>./configure
make
</code></pre>

<p>Ué&hellip;Deu um problema bizarro com o <em>FNSTSW</em> no make, então não vai ser
tão fácil assim&hellip;E lá vamos nós procurar na internet. Procurando
<a href="http://lists.alioth.debian.org/pipermail/pkg-allegro-maintainers/2009-May/000251.html" title="Pergunta em uma lista de discussão">eu descobri</a>
que tem realmente um erro em uma parte Assembly do código do Allegro
para x86 que está errada na versão 4.2.2 que provavelmente foi
consertada nas versões futuras, mas nesse caso tive que arrumar na
mão:</p>

<p>No arquivo <code>src/i386/icpus.s</code> alterar a seguinte linha (tirar a que tem
um menos e colocar a que tem um mais):</p>

<pre><code>fninit
movl $0x5A5A, %eax
-   fnstsw %eax
+   fnstsw %ax
cmpl $0, %eax
jne is_fpu_not_found
</code></pre>

<p>E assim eu consegui compilar certinho! :D</p>

<p>Quando tentei rodar meu binário me deparei com o seguinte erro: &ldquo;error
while loading shared libraries: liballeg.so.4.2: cannot open shared
object file: No such file or directory&rdquo; ¬¬</p>

<p>Pesquisando na internet novamente eu descobri que estava faltando eu
adicionar o diretório <code>/usr/local/lib</code> ao meu <code>LD_LIBRARY_PATH</code>:</p>

<p>No meu .bashrc:</p>

<pre><code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
</code></pre>

<p>OU</p>

<p>Editar o meu arquivo <code>/etc/ld.so.conf</code> e incluir <code>/usr/local/lib</code> no
final do arquivo e depois rodar o comando <code>ldconfig</code> como root ;)</p>

<p>Com isso eu consegui finalmente compilar ojogo e fazer o meu binário
rodar o meu jogo normalmente. :)</p>

<p>Espero que seja útil para mais alguem.</p>

<p><em>Old comments by: Rafael Masoni, Victor, marcelo | Not available anymore. :(</em></p>

          
<div id="disqus_thread"></div>
<script type="text/javascript">
     
    var disqus_shortname = 'pothixcom';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


        </div>
      </article>
    </main>
  </div>
</div>

        <footer class="footer-widget-area">
            <div class="inside">
                <div class="grids">
                    <aside id="stag-dribbble-2" class="widget grid-4 stag-dribbble">
                        <div>
                            
                            <h3 class="widget-title">
                                <span>Photography, a hobby</span>
                            </h3>
                            <style type="text/css">
                                .flickrimg {border: 1px solid #666666 !important; padding:1px; margin:2px;}
                                #flickr_badge_wrapper {width:366px;text-align:left}
                            </style>
                            <div id="flickr_badge_wrapper">
                                <script type="text/javascript" src="http://www.flickr.com/badge_code.gne?count=12&display=random&size=square&nsid=11054795@N06&raw=1"></script>
                            </div>
                        </div>
                    </aside>

                    <aside id="recent-posts-2" class="widget grid-4 widget_recent_entries">
                        <h3 class="widget-title">
                            <span>Last 3 books read</span>
                        </h3>

                        <ul>
                            <style type="text/css" media="screen">
                                .gr_grid_container {
                                 
                                    height:150px;
                                }

                                .gr_grid_book_container {
                                    float: left;
                                    width: 98px;
                                    height: 160px;
                                    padding: 0px 0px;
                                    overflow: hidden;
                                }
                            </style>

                            <div id="gr_grid_widget_1490660444">
                            </div>

                            <script src="https://www.goodreads.com/review/grid_widget/38970458.Willian's%20bookshelf:%20read?cover_size=medium&hide_link=true&hide_title=true&num_books=3&order=d&shelf=read&sort=date_read&widget_id=1494295777
" type="text/javascript" charset="utf-8"></script>
                        </ul>
                    </aside>

                    <aside id="text-2" class="widget grid-4 widget_text">
                        <h3 class="widget-title">
                            <span>Follow this blog</span>
                        </h3>
                        <div class="textwidget">
                            I've added three different RSS feeds here based on categories. The idea was to help you the tech guy that don't want to see what kind of motorcycle I have, or the english speaker that don't want to see portuguese posts on his feed reader.
                            <br /><br />
                            So, I have a feed for <a href="http://feeds.feedburner.com/PotHix">all my posts</a>, for the <a href="http://feeds.feedburner.com/EnglishPotHix">English posts</a> and <a href="http://feeds.feedburner.com/PotHixTech">Tech related posts</a>. Choose one and be happy! :)
                        </div>
                    </aside>
                </div>
            </div>
        </footer>

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                <div class="grids">
                    <div class="grid-6">
                        © 2017 <a href="http://demo.codestag.com/doctype/">Doctype</a> WordPress Theme by <a href="//codestag.com">Codestag</a> modified by PotHix.
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script type='text/javascript' src='/javascripts/jquery.js'></script>
    <script type='text/javascript' src='/javascripts/widget.min.js'></script>
    <script type='text/javascript' src='/javascripts/tabs.min.js'></script>
    <script type='text/javascript' src='/javascripts/jquery.custom.js'></script>
    <script type='text/javascript' src='/javascripts/plugins.js'></script>
    <script type='text/javascript' src='/javascripts/jquery.mixitup.min.js'></script>

    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2852094-2', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>

